<p-toast></p-toast>
<p-blockUI [blocked]="blockedDocument"></p-blockUI>

<div>
  <p-accordion [multiple]="true">
    <p-accordionTab header="Parameters" [selected]="true">
      <div>
        <div class="p-fluid p-grid">
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <input
                type="text"
                id="inputmodelname"
                pInputText
                [(ngModel)]="params.model_name"
                [disabled]="modelInitiated"
              />
              <label>Model Name</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.initial_infections"
                [disabled]="modelInitiated"
                [min]="1"
                [max]="params.num_agents"
                suffix=" people"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.initial_infections"
                [min]="1"
                [max]="params.num_agents"
                [step]="1"
                [disabled]="modelInitiated"
              ></p-slider>
              <label>Initial Infections</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.location.num_houses"
                [min]="0"
                [max]="200"
                [disabled]="modelInitiated"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.location.num_houses"
                [min]="0"
                [max]="200"
                [step]="1"
                [disabled]="modelInitiated"
              ></p-slider>
              <label>Number of Houses</label>
            </span>
          </div>

          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [minFractionDigits]="2"
                [min]="0"
                [max]="100"
                suffix=" %"
                [(ngModel)]="params.percentage_vaccinated[0]"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.percentage_vaccinated[0]"
                [min]="0"
                [max]="100"
                [step]="0.5"
              ></p-slider>
              <label>Vaccine#1 for unvaccinated (%)</label>
            </span>
          </div>

          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.isolation"
                [min]="0"
                [max]="30"
                suffix=" % chance of isolation when sick"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.isolation"
                [min]="0"
                [max]="30"
                [step]="1"
              ></p-slider>
              <label>Isolation</label>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid">
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                inputId="integeronly"
                [(ngModel)]="params.num_agents"
                [disabled]="modelInitiated"
              >
              </p-inputNumber>
              <label>Number of agents</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [min]="0.1"
                [max]="3.0"
                [minFractionDigits]="2"
                [(ngModel)]="params.infection_radius"
                suffix=" units"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.infection_radius"
                [min]="0.09"
                [max]="1.0"
                [step]="0.01"
              ></p-slider>
              <label>Infection Radius</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.location.num_hospitals"
                [min]="0"
                [max]="100"
                [disabled]="modelInitiated"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.location.num_hospitals"
                [min]="0"
                [max]="100"
                [step]="1"
                [disabled]="modelInitiated"
              ></p-slider>
              <label>Number of Hospitals</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [minFractionDigits]="2"
                [min]="0"
                [max]="100"
                [(ngModel)]="params.percentage_vaccinated[1]"
                suffix=" %"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.percentage_vaccinated[1]"
                [min]="0"
                [max]="100"
                [step]="0.5"
              ></p-slider>
              <label>Vaccine#2 when Vaccine#1 is done (%)</label>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid">
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                inputId="integeronly"
                [(ngModel)]="params.step_size"
                [min]="1"
                [max]="50"
                suffix=" days"
              >
              </p-inputNumber>
              <p-slider
                [(ngModel)]="params.step_size"
                [min]="1"
                [max]="50"
                [step]="1"
              ></p-slider>
              <label for="inputtext">Step size (in days)</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [minFractionDigits]="2"
                suffix=" % population"
                [min]="0"
                [max]="100"
                [(ngModel)]="params.percentage_masked"
              >
              </p-inputNumber>
              <p-slider
                [(ngModel)]="params.percentage_masked"
                [min]="0"
                [max]="100"
                [step]="1"
              ></p-slider>
              <label for="inputtext">Percentage of people masked</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.location.num_shops"
                [min]="0"
                [max]="200"
                [disabled]="modelInitiated"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.location.num_shops"
                [min]="0"
                [max]="100"
                [step]="1"
                [disabled]="modelInitiated"
              ></p-slider>
              <label>Number of Shops</label>
            </span>
          </div>

          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.social_distancing"
                [min]="0"
                [max]="100"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.social_distancing"
                [min]="0"
                [max]="100"
                [step]="2"
              ></p-slider>
              <label>Social Distancing</label>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid">
          <div class="p-field p-col-12 p-md-2 input-field"></div>
          <div class="p-field p-col-12 p-md-2 input-field"></div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputMask
                mask="99 x 99"
                [(ngModel)]="params.location.map_dimensions"
                [disabled]="modelInitiated"
              ></p-inputMask>
              <label>Map Dimensions</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.quarantine"
                [min]="0"
                [max]="100"
                suffix=" % population"
              ></p-inputNumber>
              <p-slider
                [(ngModel)]="params.quarantine"
                [min]="0"
                [max]="100"
                [step]="1"
              ></p-slider>
              <label>Home Quarantine</label>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid input-field">
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Initialize"
              (onClick)="initModel()"
              [disabled]="modelInitiated"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Update"
              (onClick)="updateModel()"
              [disabled]="!modelInitiated"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Download"
              (onClick)="downloadModelData()"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Terminate"
              (onClick)="terminateModel()"
              styleClass="p-button-secondary"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Delete"
              (onClick)="deleteModel()"
              styleClass="p-button-secondary"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-2">
            <p-button
              label="Specific: {{ showOnlyFocussedAgents }}"
              (onClick)="showOnlyFocussedAgents = !showOnlyFocussedAgents"
              [disabled]="!modelInitiated || specialFocusAgents.size === 0"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-6">
            <div class="p-inputgroup">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.migrants.count"
                [min]="0"
                [max]="50"
                [disabled]="!modelInitiated"
                suffix=" people who are"
              ></p-inputNumber>
              <p-dropdown
                [options]="params.migrants.options"
                [(ngModel)]="params.migrants.infection_status"
                [disabled]="!modelInitiated"
              ></p-dropdown>
              <button
                type="button"
                pButton
                label="Add migrants"
                [disabled]="!modelInitiated"
                (click)="addMigrants()"
              ></button>
            </div>
          </div>
        </div>
      </div>
    </p-accordionTab>
    <p-accordionTab header="Execution" [selected]="true">
      <div>
        <div class="p-fluid p-grid">
          <h4 style="margin-left: 5px">
            Hour = {{ ((currentStep - 1) % 24) + 1 }}:00, Day = {{ day }}
          </h4>
        </div>
        <div class="p-fluid p-grid" *ngIf="modelInitiated">
          <div class="p-field p-col-4">
            <span class="p-buttonset" style="min-width: 400px">
              <button
                pButton
                pRipple
                icon="pi pi-fast-backward"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('FIRST')"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-angle-double-left"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('PREVIOUS')"
                pTooltip="Previous step"
                tooltipPosition="bottom"
              ></button>
              <button
                pButton
                pRipple
                label="{{ onOff ? 'Pause' : 'Play' }}"
                (click)="handlePlayPauseClick('PLAY_PAUSE')"
              ></button>
              <p-button
                icon="pi {{ showScatterPlot ? 'pi-eye-slash' : 'pi-eye' }}"
                (onClick)="toggleScatterPlot()"
              ></p-button>
              <button
                pButton
                pRipple
                icon="pi pi-angle-double-right"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('NEXT')"
                pTooltip="Next step"
                tooltipPosition="bottom"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-fast-forward"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('LATEST')"
              ></button>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid" *ngIf="modelInitiated">
          <div
            *ngIf="showScatterPlot"
            [ngStyle]="{
              margin: '5px',
              resize: 'both',
              overflow: 'auto',
              minWidth: '800px',
              minHeight: '600px',
              width: width,
              height: height
            }"
          >
            <p-chart
              #scatterChart
              type="scatter"
              [data]="stepData"
              [options]="scatterOptions"
              width="100%"
              height="100%"
            >
            </p-chart>
          </div>
          <div
            [ngStyle]="{
              margin: '5px',
              resize: 'both',
              overflow: 'auto',
              minWidth: '800px',
              minHeight: '500px',
              width: width,
              height: height
            }"
          >
            <p-chart
              #plotChart
              type="line"
              [data]="plotData"
              [options]="plotOptions"
              width="100%"
              height="100%"
            ></p-chart>
          </div>
        </div>
      </div>
    </p-accordionTab>
  </p-accordion>
</div>
