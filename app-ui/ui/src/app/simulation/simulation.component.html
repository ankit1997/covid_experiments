<p-toast></p-toast>
<p-blockUI [blocked]="blockedDocument"></p-blockUI>

<div>
  <p-accordion [multiple]="true">
    <p-accordionTab header="Parameters" [selected]="!modelInitiated">
      <div>
        <div class="p-fluid p-grid">
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <input
                type="text"
                id="inputmodelname"
                pInputText
                [(ngModel)]="params.model_name"
                [disabled]="modelInitiated"
              />
              <label>Model Name</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.initial_infections"
                [disabled]="modelInitiated"
              ></p-inputNumber>
              <label>Initial Infections</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.location.num_houses"
                [disabled]="modelInitiated"
              ></p-inputNumber>
              <label>Number of Houses</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputMask
                mask="99 x 99"
                [(ngModel)]="params.location.map_dimensions"
                [disabled]="modelInitiated"
              ></p-inputMask>
              <label>Map Dimensions</label>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid">
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                inputId="integeronly"
                [(ngModel)]="params.num_agents"
                [disabled]="modelInitiated"
              >
              </p-inputNumber>
              <label>Number of agents</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [minFractionDigits]="2"
                [(ngModel)]="params.infection_radius"
              ></p-inputNumber>
              <label>Infection Radius</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.location.num_hospitals"
                [disabled]="modelInitiated"
              ></p-inputNumber>
              <label>Number of Hospitals</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <p-button
              label="Social Distancing: {{ params.social_distancing }}"
              (onClick)="params.social_distancing = !params.social_distancing"
            ></p-button>
          </div>
        </div>
        <div class="p-fluid p-grid">
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                inputId="integeronly"
                [(ngModel)]="params.step_size"
              >
              </p-inputNumber>
              <label for="inputtext">Step Size (in days)</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [minFractionDigits]="2"
                [min]="0"
                [max]="100"
                [(ngModel)]="params.percentage_masked"
              >
              </p-inputNumber>
              <label for="inputtext">Percentage of people masked</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                [(ngModel)]="params.location.num_empty"
                [disabled]="modelInitiated"
              ></p-inputNumber>
              <label>Number of Empty Roads</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [minFractionDigits]="2"
                [min]="0"
                [max]="100"
                [(ngModel)]="params.percentage_vaccinated[0]"
              ></p-inputNumber>
              <label>Vaccine#1 for unvaccinated (%)</label>
            </span>
          </div>
          <div class="p-field p-col-12 p-md-2 input-field">
            <span class="p-float-label">
              <p-inputNumber
                type="text"
                mode="decimal"
                [minFractionDigits]="2"
                [min]="0"
                [max]="100"
                [(ngModel)]="params.percentage_vaccinated[1]"
              ></p-inputNumber>
              <label>Vaccine#2 when Vaccine#1 is done (%)</label>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid input-field">
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Initialize"
              (onClick)="initModel()"
              [disabled]="modelInitiated"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Update"
              (onClick)="updateModel()"
              [disabled]="!modelInitiated"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Download"
              (onClick)="downloadModelData()"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-1">
            <p-button
              label="Terminate"
              (onClick)="terminateModel()"
              styleClass="p-button-secondary"
            ></p-button>
          </div>
          <div class="p-field p-col-12 p-md-2">
            <p-button
              label="Specific: {{ showOnlyFocussedAgents }}"
              (onClick)="showOnlyFocussedAgents = !showOnlyFocussedAgents"
              [disabled]="!modelInitiated || specialFocusAgents.size === 0"
            ></p-button>
          </div>
        </div>
      </div>
    </p-accordionTab>
    <p-accordionTab header="Execution" [selected]="modelInitiated">
      <div>
        <div class="p-fluid p-grid">
          <h4 style="margin-left: 5px">
            Hour: {{ currentStep }}, Day = {{ day }}
          </h4>
        </div>
        <div class="p-fluid p-grid" *ngIf="modelInitiated">
          <div class="p-field p-col-4">
            <span class="p-buttonset" style="min-width: 400px">
              <button
                pButton
                pRipple
                icon="pi pi-fast-backward"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('FIRST')"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-angle-double-left"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('PREVIOUS')"
                pTooltip="Previous step"
                tooltipPosition="bottom"
              ></button>
              <button
                pButton
                pRipple
                label="{{ onOff ? 'Pause' : 'Play' }}"
                (click)="handlePlayPauseClick('PLAY_PAUSE')"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-angle-double-right"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('NEXT')"
                pTooltip="Next step"
                tooltipPosition="bottom"
              ></button>
              <button
                pButton
                pRipple
                icon="pi pi-fast-forward"
                class="p-button-secondary p-button-text"
                (click)="handlePlayPauseClick('LATEST')"
              ></button>
            </span>
          </div>
        </div>
        <div class="p-fluid p-grid" *ngIf="modelInitiated">
          <div
            [ngStyle]="{
              margin: '5px',
              resize: 'both',
              overflow: 'auto',
              minWidth: '800px',
              minHeight: '600px',
              width: width,
              height: height
            }"
          >
            <p-chart
              #scatterChart
              type="scatter"
              [data]="stepData"
              [options]="scatterOptions"
              width="100%"
              height="100%"
            >
            </p-chart>
          </div>
          <div
            [ngStyle]="{
              margin: '5px',
              resize: 'both',
              overflow: 'auto',
              minWidth: '800px',
              minHeight: '500px',
              width: width,
              height: height
            }"
          >
            <p-chart
              #plotChart
              type="line"
              [data]="plotData"
              [options]="plotOptions"
              width="100%"
              height="100%"
            ></p-chart>
          </div>
        </div>
      </div>
    </p-accordionTab>
  </p-accordion>
</div>
